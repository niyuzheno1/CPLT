cmake_minimum_required (VERSION 3.21)
project("hello")

set(CMAKE_CXX_STANDARD 14)
set(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS ON)


set(TREE_SITTER_DLL_DIR "${CMAKE_CURRENT_SOURCE_DIR}/tree_sitter_dll/src")
set(TREE_SITTER_EXE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/tree_sitter_exe/src")
set(TREE_SITTER_LIB_DIR "${CMAKE_CURRENT_SOURCE_DIR}/tree_sitter_cplt/src")


file(GLOB TREE_SITTER_DLL_SOURCE_FILES
     "${TREE_SITTER_DLL_DIR}/*.cpp"
     "${TREE_SITTER_DLL_DIR}/*.h"
     "${TREE_SITTER_DLL_DIR}/*.c"
     )

file(GLOB TREE_SITTER_EXE_SOURCE_FILES
     "${TREE_SITTER_EXE_DIR}/*.cpp"
)

file(GLOB TREE_SITTER_LIB_SOURCE_FILES
     "${TREE_SITTER_LIB_DIR}/*.cpp"
     "${TREE_SITTER_LIB_DIR}/*.h"
     "${TREE_SITTER_LIB_DIR}/*.c"
     )

include(GenerateExportHeader)
add_library(tree_sitter_dll SHARED  ${TREE_SITTER_DLL_SOURCE_FILES})
generate_export_header(tree_sitter_dll)

add_library(tree_sitter_lib  ${TREE_SITTER_LIB_SOURCE_FILES})

target_include_directories(tree_sitter_dll PUBLIC ${PROJECT_BINARY_DIR} ${PROJECT_SOURCE_DIR})

add_executable(tree_sitter_exe ${TREE_SITTER_EXE_SOURCE_FILES})
target_link_libraries(tree_sitter_exe PRIVATE tree_sitter_dll)
target_link_libraries(tree_sitter_exe PRIVATE tree_sitter_lib)


if(MSVC)
    set_property(DIRECTORY PROPERTY VS_STARTUP_PROJECT tree_sitter_exe)
endif()